<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Notery Ultimate</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:system-ui;background:#0f172a;color:#e5e7eb;}
#toolbar{display:flex;gap:6px;padding:8px;background:#020617;flex-wrap:wrap;position:sticky;top:0;z-index:10}
button,select,input[type=color]{background:#020617;color:white;border:1px solid #334155;padding:5px 10px;border-radius:6px}
button.active{background:#2563eb}
#container{display:flex;height:calc(100vh - 52px)}
#notes,#boardWrap{flex:1}
#notes{padding:10px;outline:none;overflow:auto;background:#020617}
#boardWrap{position:relative;background:white}
canvas{display:block}
.hidden{display:none}
#laser{position:absolute;width:14px;height:14px;border-radius:50%;background:red;pointer-events:none;opacity:0.8;display:none}
</style>
</head>
<body>

<div id="toolbar">
  <button onclick="setMode('text')">Text</button>
  <button onclick="setMode('board')">Board</button>
  <button onclick="setMode('split')" class="active">Split</button>
  <button onclick="setMode('projection')">Projection</button>

  <button onclick="setTool('draw')">Draw</button>
  <button onclick="setTool('line')">Line</button>
  <button onclick="setTool('rect')">Rect</button>
  <button onclick="setTool('circle')">Circle</button>
  <button onclick="setTool('erase')">Erase</button>
  <button onclick="setTool('laser')">Laser</button>
  <input type="color" id="colorPicker" value="#000000">
</div>

<div id="container">
  <div id="notes" contenteditable="true"></div>
  <div id="boardWrap">
    <canvas id="board"></canvas>
    <div id="laser"></div>
  </div>
</div>

<script>
let mode='split', tool='draw', color='#000', drawing=false, start=null;
const notes=document.getElementById('notes');
const wrap=document.getElementById('boardWrap');
const canvas=document.getElementById('board');
const ctx=canvas.getContext('2d');
const laser=document.getElementById('laser');

let objects=[];

function resize(){
  canvas.width=wrap.clientWidth;
  canvas.height=wrap.clientHeight;
  redraw();
}
window.onresize=resize;

function redraw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  objects.forEach(o=>{
    ctx.strokeStyle=o.color;
    ctx.lineWidth=o.size;
    ctx.globalCompositeOperation=o.tool==='erase'?'destination-out':'source-over';
    ctx.beginPath();
    if(o.tool==='draw'||o.tool==='line'){
      o.points.forEach((p,i)=>i?ctx.lineTo(p.x,p.y):ctx.moveTo(p.x,p.y));
    }
    if(o.tool==='rect'){
      const a=o.points[0],b=o.points[1];
      ctx.rect(a.x,a.y,b.x-a.x,b.y-a.y);
    }
    if(o.tool==='circle'){
      const a=o.points[0],b=o.points[1];
      const r=Math.hypot(b.x-a.x,b.y-a.y);
      ctx.arc(a.x,a.y,r,0,Math.PI*2);
    }
    ctx.stroke();
  });
}

canvas.onpointerdown=e=>{
  if(tool==='laser'){ laser.style.display='block'; moveLaser(e); return; }
  drawing=true;
  start=pos(e);
  objects.push({tool,color,size:tool==='erase'?20:3,points:[start]});
};
canvas.onpointermove=e=>{
  if(tool==='laser'){ moveLaser(e); return; }
  if(!drawing)return;
  const p=pos(e);
  if(tool==='draw'||tool==='erase') objects.at(-1).points.push(p);
  else objects.at(-1).points[1]=p;
  redraw();
};
canvas.onpointerup=()=>{
  if(tool==='laser'){ laser.style.display='none'; return; }
  drawing=false;
};

function pos(e){
  const r=canvas.getBoundingClientRect();
  return{x:e.clientX-r.left,y:e.clientY-r.top};
}
function moveLaser(e){
  const p=pos(e);
  laser.style.left=p.x-7+'px';
  laser.style.top=p.y-7+'px';
}

function setTool(t){tool=t;}
document.getElementById('colorPicker').oninput=e=>color=e.target.value;

function setMode(m){
  mode=m;
  document.querySelectorAll('#toolbar button').forEach(b=>b.classList.remove('active'));
  event.target.classList.add('active');
  notes.classList.toggle('hidden',m!=='text'&&m!=='split');
  wrap.classList.toggle('hidden',m==='text');
  if(m==='projection'){
    notes.classList.add('hidden');
    wrap.classList.remove('hidden');
    document.getElementById('container').style.flexDirection='column';
  }else{
    document.getElementById('container').style.flexDirection='row';
  }
  resize();
}

resize();
</script>
</body>
</html>
